# 故障排除指南

## "Max retries exceeded" 错误解决方案

当您遇到 "Max retries exceeded" 错误时，这通常表示 Backpack 下单失败。以下是可能的原因和解决方案：

### 可能的原因

1. **市场波动过大**
   - 价格变化太快，导致订单价格不合适
   - 价差过大，影响下单成功率

2. **账户问题**
   - 余额不足
   - 账户权限问题
   - API 密钥配置错误

3. **网络问题**
   - 网络连接不稳定
   - API 服务器响应慢

4. **订单参数问题**
   - 订单数量过大或过小
   - 价格精度问题

### 解决方案

#### 1. 检查账户状态
```bash
# 检查账户余额和权限
# 确保您的 Backpack 账户有足够的余额进行交易
```

#### 2. 调整交易参数
```bash
# 使用更小的订单数量
python hedge_mode.py --exchange backpack --ticker BTC --size 0.001 --iter 5

# 使用更短的维持时间进行测试
python hedge_mode.py --exchange backpack --ticker BTC --size 0.01 --iter 3 --hold-time 60
```

#### 3. 检查市场条件
- 避免在市场波动极大的时候运行策略
- 选择流动性较好的交易对
- 检查价差是否合理（通常应小于 1%）

#### 4. 网络和配置检查
```bash
# 检查网络连接
ping api.backpack.exchange

# 验证环境变量配置
echo $BACKPACK_PUBLIC_KEY
echo $BACKPACK_SECRET_KEY
```

#### 5. 使用诊断功能
新的版本包含了自动诊断功能，当遇到错误时会自动提供：
- 当前市场价格信息
- 价差分析
- 账户状态检查
- 订单参数验证

### 预防措施

1. **从小额开始**
   - 使用较小的订单数量进行测试
   - 逐步增加交易规模

2. **监控市场条件**
   - 避免在重大新闻发布时交易
   - 选择流动性充足的时间段

3. **定期检查**
   - 定期检查账户余额
   - 监控 API 使用情况

4. **备用方案**
   - 准备多个交易所的配置
   - 使用 Extended 交易所作为备选

### 联系支持

如果问题持续存在，请：
1. 收集完整的错误日志
2. 记录发生错误时的市场条件
3. 提供您的配置参数（隐藏敏感信息）
4. 联系技术支持团队

### 更新日志

- **v1.1**: 添加了智能价格调整策略
- **v1.1**: 增加了自动诊断功能
- **v1.1**: 改进了错误处理和重试机制
- **v1.1**: 添加了维持时间参数支持
- **v1.2**: 修复了 `'HedgeBot' object has no attribute 'is_running'` 错误
- **v1.2**: 改进了异步关闭机制，解决 "Unclosed client session" 警告
- **v1.2**: 增强了错误处理和资源清理
